import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as u,d as y}from"./firebase-CT_HnxDN.js";import{updateDoc as q,doc as L,query as k,collection as B,orderBy as T,getDocs as I,where as b,serverTimestamp as U,addDoc as te,limit as oe,deleteDoc as ne}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";import{onAuthStateChanged as _,signOut as ae}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";const ie="https://api.mymemory.translated.net/get",re=800,R=100,Q={brb:"be right back",yolo:"you only live once",fam:"family",tbh:"to be honest",imo:"in my opinion",fomo:"fear of missing out",rn:"right now",yo:"hi","sassy man":"zesty guy","onika burger":"nicki minaj is fat","onika burger":"nicki minaj is fat",idgaf:"I don't give a f***","water is tight":"person does not have water at all",motion:"money",bruh:"bro",gtg:"got to go",idk:"I don't know","tung tung tung sahur":"mad man",lol:"laughing out loud",smh:"shaking my head",btw:"by the way",lit:"amazing",cap:"lie","no cap":"no lie","broke boi":"poor person","clock it":"get that",slaps:"is really good",sus:"suspicious",tea:"gossip",woke:"aware",thirsty:"desperate for attention",savage:"ruthless",lowkey:"somewhat",highkey:"definitely",clout:"influence or fame",shade:"insult",fr:"for real",bet:"okay/sure",goat:"greatest of all time",stan:"overzealous supporter",ship:"support a relationship",extra:"over the top",bussin:"really good",snatched:"looking good","vibe check":"how are you feeling",cheugy:"out of date or trying too hard",mc:"main character","hits different":"better than usual",bop:"thot",canceled:"exiled",ghosted:"ignored",salty:"mad",fire:"really good",vibes:"feelings",flex:"show off",bro:"brother",diddy:"baby oil needed for the little children in my basement",flexing:"showing off",dope:"cool",irl:"in real life",idrc:"I don't really care",idc:"I don't care",iykyk:"if you know you know",wyd:"what are you doing",wby:"what about you","what's good":"hello",bestie:"best friend",boutta:"about to",deadass:"seriously",cooked:"going to fail",jit:"young person",typeshit:"agree",ate:"did great",finna:"going to",gas:"cool/amazing",mid:"average",rizz:"charm",mood:"relatable",snack:"attractive",whip:"car",wildin:"acting crazy","wildin'":"acting crazy",fruity:"gay",drip:"stylish",dawg:"friend","on god":"I swear",hella:"very",fit:"outfit",aura:"vibe/energy",tweaking:"overreacting","caught slippin":"made a mistake","caught slippin'":"made a mistake","caught in 4k":"caught red-handed",based:"approved","big back":"fat ass",od:"overdoing it",ops:"enemies",op:"overpowered",trenches:"the streets",mogging:"dominating","hol up":"wait a moment","hold up":"wait a moment",chief:"leader",bread:"money",sigma:"alpha",word:"I agree",og:"original",fineshyt:"goodlooking",gr8:"great",str8:"straight","soft launch":"subtle reveal","down bad":"desperate",icymi:"in case you missed it","plot armor":"protected by luck","bricked up":"aroused",wassup:"what is up","whats up":"what is up","what's up":"what is up",sup:"what is up",gotchu:"I got you","got you":"I understand / I will help",gottem:"got them",brodie:"close friend",gang:"friends / group","no kizzy":"no lie",bffr:"be for real",ong:"on god",ion:"I don't",iont:"I don't",tryna:"trying to",wya:"where you at",hmu:"hit me up",lmk:"let me know",oml:"oh my lord",oomf:"one of my followers",gn:"goodnight",gm:"good morning",asl:"as hell",smth:"something",rlly:"really",prolly:"probably",jus:"just",mb:"my bad",tf:"the f***",stg:"swear to god",idwt:"I don't want to","my fault":"I'm sorry","locked in":"focused",slime:"close friend",pookie:"cute person",gyat:"big butt",gyatt:"big butt",skibidi:"nonsense joke word","rizz god":"person with a lot of charm",delulu:"delusional",situationship:"unclear relationship",npc:"boring predictable person","wassup bro":"what is up brother","wassup g":"what is up friend",wussup:"what is up",waddup:"what is up",wuzgood:"what is good"};function se(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function le(e){let t=e;for(const[o,n]of Object.entries(Q)){const r=se(o),a=new RegExp(`\\b${r}\\b`,"gi");t=t.replace(a,n)}return t}const C=document.getElementById("translateBtn"),f=document.getElementById("inputText"),l=document.getElementById("outputText"),h=document.getElementById("fromLang"),p=document.getElementById("toLang"),H=document.getElementById("swapBtn"),s=document.getElementById("micBtn"),A=document.getElementById("favoritesBtn"),N=document.getElementById("settingsBtn"),v=document.getElementById("darkModeToggle"),d=document.getElementById("slangToggle");function de(){setTimeout(()=>{const e=document.getElementById("tooltip"),t=document.getElementById("tooltip2");e&&(e.style.display="none"),t&&(t.style.display="none")},1e4)}function ce(){localStorage.getItem("darkMode")==="true"&&(document.body.classList.add("dark-mode"),v&&(v.checked=!0)),localStorage.getItem("slangMode")==="true"&&d&&(d.checked=!0,M(),Y())}window.addEventListener("load",()=>{de(),ce()});function Y(){p&&(p.value="en")}function M(){const e=document.getElementById("toLang");e&&(e.disabled=!0)}function G(){const e=document.getElementById("toLang");e&&(e.disabled=!1)}function ue(){d&&(d.checked?(M(),Y()):G())}d&&d.addEventListener("change",()=>{localStorage.setItem("slangMode",d.checked),ue()});H&&H.addEventListener("click",()=>{const e=h.value;h.value=p.value,p.value=e;const t=f.value;f.value=l.value,l.value=t,console.log(`Swapped: ${h.value} â†” ${p.value}`)});async function S(){const e=(f?.value||"").trim(),t=(h?.value||"en").toLowerCase(),o=(p?.value||"en").toLowerCase();if(!e){l&&(l.value="");return}const n=localStorage.getItem("slangMode")==="true"||(d?.checked??!1),r=n?le(e):e;if(t==="en"&&o==="en"){l&&(l.value=r),u.currentUser&&(await D(u.currentUser.uid,{originalInput:e,processedInput:r,from:t,to:o,output:r,slangMode:n}),await O(u.currentUser.uid));return}l&&(l.value="Translating...");try{const a=await fetch(`${ie}?q=${encodeURIComponent(r)}&langpair=${t}|${o}`);if(!a.ok)throw new Error(`HTTP error ${a.status}`);const c=(await a.json()).responseData?.translatedText||"Translation failed.";l&&(l.value=c);const i=u.currentUser;i?(await D(i.uid,{originalInput:e,processedInput:r,from:t,to:o,output:c,slangMode:n}),await O(i.uid)):console.warn("No auth user available - translations won't be persisted.")}catch(a){console.error("Translation error:",a),l&&(l.value="âŒ Error connecting to translation service.")}}let j=null;f&&f.addEventListener("input",()=>{clearTimeout(j),j=setTimeout(S,re)});C&&C.addEventListener("click",S);async function D(e,t){try{const o=B(y,"users",e,"history"),n=k(o,b("originalInput","==",t.originalInput),b("from","==",t.from),b("to","==",t.to)),r=await I(n);if(!r.empty){const a=r.docs[0],g=a.data(),c=L(y,"users",e,"history",a.id),i=!!g.favorite;await q(c,{originalInput:t.originalInput,processedInput:t.processedInput,output:t.output,from:t.from,to:t.to,slangMode:!!t.slangMode,favorite:i,timestamp:U()}),console.log(`Updated existing history doc (duplicate) id=${a.id}`);return}await te(o,{originalInput:t.originalInput,processedInput:t.processedInput,output:t.output,from:t.from,to:t.to,favorite:!1,slangMode:!!t.slangMode,timestamp:U()}),console.log("Saved new translation to history.")}catch(o){console.error("Error in saveOrUpdateTranslation:",o)}}async function O(e){try{const t=B(y,"users",e,"history"),o=k(t,T("timestamp","desc")),r=(await I(o)).size;if(r<=R)return;const a=r-R;console.log(`Trimming history: need to remove ${a} non-favorited items.`);const g=k(t,b("favorite","==",!1),T("timestamp","asc"),oe(a)),c=await I(g);if(c.empty){console.warn("No non-favorited entries to delete; history may exceed cap due to favorites.");return}let i=0;for(const w of c.docs)try{await ne(L(y,"users",e,"history",w.id)),i++,console.log("Deleted old history doc:",w.id)}catch($){console.warn("Failed to delete old history doc:",$)}console.log(`Trimmed ${i} history docs.`)}catch(t){console.error("Error trimming history:",t)}}async function x(){const e=u.currentUser;if(!e)return;const t=document.getElementById("history"),o=document.getElementById("favorites");t&&(t.innerHTML="Loading..."),o&&(o.innerHTML="Loading...");try{const n=k(B(y,"users",e.uid,"history"),T("timestamp","desc")),r=await I(n);let a="",g="";r.forEach(c=>{const i=c.data(),w=i.originalInput??"",$=i.processedInput??"",K=i.output??"",W=i.from??"",J=i.to??"",E=!!i.favorite,Z=!!i.slangMode?`[slang] "${m(w)}"`:`"${m(w)}"`,X=`"${m(K)}"`,ee=`${m(W)} â†’ ${m(J)}`,z=`
        <div class="p-2 border rounded mb-2 d-flex justify-content-between align-items-center">
          <div>
            <strong>${Z}</strong> â†’ ${X}
            <small class="text-muted d-block">${ee}</small>
          </div>
          <i class="bi ${E?"bi-star-fill text-warning":"bi-star"}"
             style="cursor:pointer;"
             onclick="toggleFavorite('${c.id}', ${!E})"></i>
        </div>`;a+=z,E&&(g+=z)}),t&&(t.innerHTML=a||"<p>No history yet.</p>"),o&&(o.innerHTML=g||"<p>No favorites yet.</p>")}catch(n){console.error("Failed to load user translations:",n),t&&(t.innerHTML="<p>Failed to load history.</p>"),o&&(o.innerHTML="<p>Failed to load favorites.</p>")}}function m(e){return e?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):""}function ge(){return Object.entries(Q).sort(([t],[o])=>t.localeCompare(o)).map(([t,o])=>`<p><strong>${m(t)}</strong> â€” ${m(o)}</p>`).join("")}const F=document.getElementById("slangDictBtn");F&&F.addEventListener("click",()=>{const e=document.getElementById("slangDictModal"),t=document.getElementById("slangDictContent");t&&(t.innerHTML=ge()),new bootstrap.Modal(e).show()});window.toggleFavorite=async(e,t)=>{const o=u.currentUser;if(!o){alert("Please sign in to favorite items.");return}try{await q(L(y,"users",o.uid,"history",e),{favorite:t}),await x()}catch(n){console.error("Failed to update favorite:",n)}};A&&A.addEventListener("click",()=>{const e=document.getElementById("favoritesModal");if(!e)return;new bootstrap.Modal(e).show(),x()});const P=window.SpeechRecognition||window.webkitSpeechRecognition;if(!P)s&&(s.disabled=!0,s.textContent="Not supported");else{const e=new P;e.continuous=!1,e.interimResults=!1;const t={en:"en-US",es:"es-ES",fr:"fr-FR",de:"de-DE",it:"it-IT",pt:"pt-PT",nl:"nl-NL",ru:"ru-RU","zh-CN":"zh-CN","zh-TW":"zh-TW",ja:"ja-JP",ko:"ko-KR",ar:"ar-SA",tr:"tr-TR",pl:"pl-PL",sv:"sv-SE",da:"da-DK",fi:"fi-FI",no:"no-NO",el:"el-GR",cs:"cs-CZ",hu:"hu-HU",ro:"ro-RO",bg:"bg-BG",hi:"hi-IN",id:"id-ID",ms:"ms-MY",th:"th-TH",vi:"vi-VN",he:"he-IL",uk:"uk-UA"};s&&s.addEventListener("click",()=>{try{e.lang=t[h.value]||"en-US",e.start(),s.textContent="Listening...",s.classList.add("btn-danger")}catch(o){console.error("Mic start error:",o)}}),e.addEventListener("result",o=>{const n=o.results[0][0].transcript;f&&(f.value=n,S()),console.log("Speech recognized:",n)}),e.addEventListener("end",()=>{s&&(s.textContent="ðŸŽ¤ Speak",s.classList.remove("btn-danger"))}),e.addEventListener("error",o=>{console.error("Speech recognition error:",o.error),s&&(s.textContent="ðŸŽ¤ Speak",s.classList.remove("btn-danger"))})}N&&N.addEventListener("click",()=>{const e=document.getElementById("settingsModal");if(!e)return;new bootstrap.Modal(e).show()});v&&v.addEventListener("change",()=>{const e=v.checked;document.body.classList.toggle("dark-mode",e),localStorage.setItem("darkMode",e)});d&&d.addEventListener("change",()=>{const e=d.checked;localStorage.setItem("slangMode",e),e?(h.value="en",p.value="en",M()):G()});_(u,e=>{e?(console.log("Auth ready:",e.email),x()):console.log("No user signed in")});_(u,e=>{if(!e)alert("Please log in to access the translator."),window.location.href="Login.html";else{console.log("User authenticated:",e.email);const t=document.getElementById("user-name");t&&(t.textContent=e.displayName||e.email)}});const V=document.getElementById("logoutBtn");V&&V.addEventListener("click",()=>{ae(u).then(()=>{console.log("user logged out"),window.location.herf="login.html"}).catch(e=>{console.error("logout error:",e)})});
